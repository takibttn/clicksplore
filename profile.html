<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Clicksplore Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    background: #0a0b0d;
    color: #ffffff;
    overflow-x: hidden;
    line-height: 1.6;
}

/* Animated Background */
.bg-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: linear-gradient(45deg, #0a0b0d, #1a1b1f, #2a1b3d);
    background-size: 400% 400%;
    animation: gradientShift 8s ease infinite;
}

.bg-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(119, 198, 255, 0.3) 0%, transparent 50%);
    animation: float 6s ease-in-out infinite;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-20px) rotate(1deg); }
    66% { transform: translateY(10px) rotate(-1deg); }
}

/* Main Container */
.profile-container {
    min-height: 100vh;
    padding: 2rem;
    position: relative;
    z-index: 1;
}

/* Navigation */
.nav-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 70px;
    background: rgba(10, 11, 13, 0.8);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    transition: all 0.3s ease;
}

.nav-brand {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
    0%, 100% { filter: hue-rotate(0deg); }
    50% { filter: hue-rotate(180deg); }
}

.nav-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.nav-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    cursor: pointer;
    font-size: 0.9rem;
}

.nav-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
}

/* Hero Section */
.hero-section {
    margin-top: 70px;
    padding: 4rem 0;
    text-align: center;
    position: relative;
}

.profile-avatar-hero {
    width: 180px;
    height: 180px;
    margin: 0 auto 2rem;
    position: relative;
    cursor: pointer;
}

.avatar-ring {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(from 0deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #ff6b6b);
    padding: 4px;
    animation: rotate 4s linear infinite;
    position: relative;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.avatar-inner {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: #1a1b1f;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4rem;
    font-weight: bold;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.avatar-inner:hover {
    transform: scale(1.05);
}

.avatar-upload-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    border-radius: 50%;
    cursor: pointer;
}

.avatar-inner:hover .avatar-upload-overlay {
    opacity: 1;
}

.hero-title {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: textFloat 3s ease-in-out infinite;
}

@keyframes textFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.hero-subtitle {
    font-size: 1.5rem;
    opacity: 0.8;
    margin-bottom: 2rem;
    font-weight: 300;
}

.hero-role {
    display: inline-block;
    padding: 0.75rem 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    margin-bottom: 3rem;
    transition: all 0.3s ease;
}

.hero-role:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Stats Cards */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin: 4rem 0;
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
    backdrop-filter: blur(20px);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.8s ease;
}

.stat-card:hover::before {
    left: 100%;
}

.stat-card:hover {
    transform: translateY(-10px) scale(1.05);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.stat-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    background: linear-gradient(45deg, #45b7d1, #96ceb4);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-label {
    opacity: 0.7;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Content Grid */
.content-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
}

@media (max-width: 1024px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
}

/* Glass Cards */
.glass-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    padding: 3rem;
    backdrop-filter: blur(20px);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.glass-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, rgba(255, 107, 107, 0.05), rgba(78, 205, 196, 0.05), rgba(69, 183, 209, 0.05));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.glass-card:hover::before {
    opacity: 1;
}

.glass-card:hover {
    transform: translateY(-8px);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
}

.card-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.card-icon {
    font-size: 1.8rem;
}

/* Form Styles */
.form-group {
    margin-bottom: 2rem;
}

.form-label {
    display: block;
    margin-bottom: 0.75rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.form-input {
    width: 100%;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: white;
    font-size: 1rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.form-input:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.1);
    border-color: #4ecdc4;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(78, 205, 196, 0.2);
}

.form-input::placeholder {
    color: rgba(255, 255, 255, 0.4);
}

/* Buttons */
.btn {
    padding: 1rem 2rem;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    color: white;
    border: 2px solid transparent;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
    filter: brightness(1.1);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(255, 255, 255, 0.1);
}

.btn-danger {
    background: linear-gradient(45deg, #ff6b6b, #ee5a52);
    color: white;
    border: 2px solid transparent;
}

.btn-danger:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
    filter: brightness(1.1);
}

/* Tabs */
.tab-container {
    margin-bottom: 3rem;
}

.tab-nav {
    display: flex;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 0.5rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
    flex: 1;
    padding: 1rem 1.5rem;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    position: relative;
}

.tab-btn.active {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
}

.tab-btn:not(.active):hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
}

.tab-content {
    display: none;
    animation: fadeIn 0.5s ease;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Activity Items */
.activity-list {
    space-y: 1rem;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.activity-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(8px);
    border-color: rgba(255, 255, 255, 0.2);
}

.activity-icon-wrapper {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    font-size: 1.2rem;
    color: white;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.activity-time {
    font-size: 0.85rem;
    opacity: 0.6;
}

/* Permissions Grid */
.permissions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.permission-card {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.permission-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.permission-card.active::before {
    opacity: 1;
}

.permission-card.active {
    border-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.1);
    transform: translateY(-4px);
}

.permission-card:hover {
    transform: translateY(-4px);
    border-color: rgba(255, 255, 255, 0.3);
}

.permission-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.permission-toggle {
    width: 50px;
    height: 28px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 14px;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.permission-toggle.active {
    background: linear-gradient(45deg, #4ecdc4, #45b7d1);
}

.permission-toggle::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 24px;
    height: 24px;
    background: white;
    border-radius: 50%;
    transition: transform 0.3s ease;
}

.permission-toggle.active::after {
    transform: translateX(22px);
}

/* Notifications */
.notification {
    position: fixed;
    top: 90px;
    right: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    backdrop-filter: blur(20px);
    color: white;
    z-index: 1000;
    transform: translateX(400px);
    transition: transform 0.4s ease;
    max-width: 350px;
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    border-left: 4px solid #4ecdc4;
}

.notification.error {
    border-left: 4px solid #ff6b6b;
}

.notification.warning {
    border-left: 4px solid #ffeaa7;
}

/* Loading Animation */
.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 3rem;
    color: rgba(255, 255, 255, 0.6);
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top: 3px solid #4ecdc4;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .profile-container {
        padding: 1rem;
    }

    .hero-title {
        font-size: 2.5rem;
    }

    .stats-container {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .glass-card {
        padding: 2rem;
    }

    .nav-bar {
        padding: 0 1rem;
    }

    .nav-actions {
        gap: 0.5rem;
    }

    .nav-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
    }
}

/* Scroll Animations */
.fade-in-up {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.6s ease;
}

.fade-in-up.visible {
    opacity: 1;
    transform: translateY(0);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(45deg, #4ecdc4, #45b7d1);
}

/* Particle Effect */
.particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: float-particle 10s infinite linear;
}

@keyframes float-particle {
    0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
    }
}
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-container"></div>

    <!-- Navigation -->
    <nav class="nav-bar">
        <div class="nav-brand">
            <i class="fas fa-bolt"></i>
            Clicksplore
        </div>
        <div class="nav-actions">
            <a href="dashboard.html" class="nav-btn">
                <i class="fas fa-dashboard"></i>
                Dashboard
            </a>
            <button class="nav-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>
    </nav>

    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <div class="profile-container">
        <!-- Hero Section -->
        <section class="hero-section fade-in-up">
            <div class="profile-avatar-hero" onclick="uploadAvatar()">
                <div class="avatar-ring">
                    <div class="avatar-inner" id="avatarInner">
                        <span id="avatarInitials">LU</span>
                        <div class="avatar-upload-overlay">
                            <i class="fas fa-camera" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
            <h1 class="hero-title" id="heroTitle">Loading...</h1>
            <p class="hero-subtitle">Welcome back to your command center</p>
            <div class="hero-role" id="heroRole">
                <i class="fas fa-crown"></i>
                <span id="roleText">Loading...</span>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="stats-container fade-in-up">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="stat-value" id="daysActive">-</div>
                <div class="stat-label">Days Active</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="stat-value" id="permissionsCount">-</div>
                <div class="stat-label" id="permissionsLabel">Permissions</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-value" id="lastLogin">-</div>
                <div class="stat-label">Last Login</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-value" id="activityScore">-</div>
                <div class="stat-label" id="activityLabel">Activity Score</div>
            </div>
        </section>

        <!-- Content Grid -->
        <div class="content-grid fade-in-up">
            <!-- Personal Information -->
            <div class="glass-card">
                <h2 class="card-title">
                    <i class="fas fa-user card-icon"></i>
                    Personal Information
                </h2>
                
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label class="form-label" for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-input" placeholder="Enter your full name" value="">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="email">Email Address</label>
                        <input type="email" id="email" class="form-input" placeholder="Enter your email" value="" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="role">Role</label>
                        <input type="text" id="role" class="form-input" value="" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="phone">Phone</label>
                        <input type="text" id="phone" class="form-input" placeholder="Enter your phone number" value="">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </form>
            </div>

            <!-- Security Settings -->
            <div class="glass-card">
                <h2 class="card-title">
                    <i class="fas fa-shield-alt card-icon"></i>
                    Security Center
                </h2>

                <div class="tab-container">
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="switchTab('password')">
                            <i class="fas fa-key"></i>
                            Password
                        </button>
                        <button class="tab-btn" onclick="switchTab('sessions')">
                            <i class="fas fa-desktop"></i>
                            Sessions
                        </button>
                    </div>

                    <!-- Password Tab -->
                    <div id="password-tab" class="tab-content active">
                        <form id="passwordForm">
                            <div class="form-group">
                                <label class="form-label" for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="newPassword">New Password</label>
                                <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="confirmPassword">Confirm Password</label>
                                <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-lock"></i>
                                Update Password
                            </button>
                        </form>
                    </div>

                    <!-- Sessions Tab -->
                    <div id="sessions-tab" class="tab-content">
                        <div class="activity-list" id="sessionsList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading sessions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Permissions (for admin users only) -->
            <div class="glass-card" id="permissionsCard" style="display: none;">
                <h2 class="card-title">
                    <i class="fas fa-key card-icon"></i>
                    Access Control
                </h2>
                
                <div class="permissions-grid" id="permissionsGrid">
                    <!-- Permissions will be loaded dynamically -->
                </div>

                <button class="btn btn-primary" style="margin-top: 2rem;" onclick="updatePermissions()">
                    <i class="fas fa-save"></i>
                    Update Permissions
                </button>
            </div>

            <!-- User Subscriptions -->
            <div class="glass-card">
                <h2 class="card-title">
                    <i class="fas fa-star card-icon"></i>
                    My Subscriptions
                </h2>

                <div class="activity-list" id="subscriptionsList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Loading subscriptions...
                    </div>
                </div>

                <button class="btn btn-secondary" style="width: 100%; margin-top: 1.5rem;" onclick="window.location.href='services.html'">
                    <i class="fas fa-plus"></i>
                    Browse Services
                </button>
            </div>

            <!-- Activity Log -->
            <div class="glass-card">
                <h2 class="card-title">
                    <i class="fas fa-history card-icon"></i>
                    Recent Activity
                </h2>

                <div class="activity-list" id="activityLog">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Loading activity...
                    </div>
                </div>

                <button class="btn btn-secondary" style="width: 100%; margin-top: 1.5rem;" onclick="viewFullActivity()">
                    <i class="fas fa-eye"></i>
                    View Full Activity Log
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for avatar upload -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script>
        // API Configuration
const API_BASE_URL = window.location.origin + '/admin/api';
let currentUser = null;
let userProfile = null;
let isAdmin = false;

// Check authentication on page load
async function checkAuth() {
    try {
        const response = await fetch(`${API_BASE_URL}/profile`, {
            credentials: 'include'
        });
        
        if (!response.ok) {
            if (response.status === 401 || response.status === 403) {
                console.log('Not authenticated, redirecting to login');
                window.location.href = 'login.html';
                return;
            }
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        currentUser = data.user;
        userProfile = data.admin;
        isAdmin = true;
        
        console.log('Authenticated user:', currentUser);
        await populateAdminProfile(userProfile);
    } catch (error) {
        console.error('Auth check error:', error);
        window.location.href = 'login.html';
    }
}

// Populate admin profile data
async function populateAdminProfile(profile) {
    document.getElementById('heroTitle').textContent = profile.full_name || 'Admin User';
    document.getElementById('email').value = profile.email;
    document.getElementById('fullName').value = profile.full_name || '';
    document.getElementById('phone').value = profile.phone || '';
    document.getElementById('role').value = profile.role || 'admin';
    document.getElementById('roleText').textContent = capitalizeRole(profile.role);

    // Update avatar initials
    const initials = getInitials(profile.full_name || profile.email);
    document.getElementById('avatarInitials').textContent = initials;

    // Show permissions card for admin
    document.getElementById('permissionsCard').style.display = 'block';
    populatePermissions(profile.permissions || []);

    // Load admin stats
    await loadAdminStats(profile);
    
    // Load admin activity
    await loadAdminActivity();
    
    // Load notifications
    await loadNotifications();
}

// Load admin statistics
async function loadAdminStats(profile) {
    try {
        // Calculate days active
        const createdAt = new Date(profile.created_at);
        const now = new Date();
        const daysActive = Math.floor((now - createdAt) / (1000 * 60 * 60 * 24));
        document.getElementById('daysActive').textContent = daysActive;

        // Permissions count
        const permissionsCount = (profile.permissions || []).length;
        document.getElementById('permissionsCount').textContent = permissionsCount;

        // Last login
        const lastLogin = profile.last_login ? formatTimeAgo(new Date(profile.last_login)) : 'Never';
        document.getElementById('lastLogin').textContent = lastLogin;

        // Activity score (placeholder for admin)
        document.getElementById('activityScore').textContent = '100%';
    } catch (error) {
        console.error('Error loading admin stats:', error);
    }
}

// Populate permissions for admin
function populatePermissions(permissions) {
    const permissionsGrid = document.getElementById('permissionsGrid');
    const allPermissions = [
        { key: 'read', name: 'Read Access', description: 'View all content and data' },
        { key: 'write', name: 'Write Access', description: 'Create and modify content' },
        { key: 'delete', name: 'Delete Access', description: 'Delete content and records' },
        { key: 'admin', name: 'Admin Panel', description: 'Access administrative features' },
        { key: 'analytics', name: 'Analytics', description: 'View detailed analytics and reports' },
        { key: 'financial', name: 'Financial Data', description: 'Access financial information' },
        { key: 'user_management', name: 'User Management', description: 'Manage user accounts and roles' },
        { key: 'manage_users', name: 'Manage Users', description: 'Create and modify user accounts' }
    ];

    permissionsGrid.innerHTML = '';
    allPermissions.forEach(perm => {
        const isActive = permissions.includes(perm.key);
        const card = document.createElement('div');
        card.className = `permission-card ${isActive ? 'active' : ''}`;
        card.innerHTML = `
            <div class="permission-header">
                <div class="permission-toggle ${isActive ? 'active' : ''}" data-permission="${perm.key}"></div>
                <div>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">${perm.name}</div>
                    <div style="font-size: 0.85rem; opacity: 0.7;">${perm.description}</div>
                </div>
            </div>
        `;
        permissionsGrid.appendChild(card);
    });
}

// Load admin activity
async function loadAdminActivity() {
    try {
        const response = await fetch(`${API_BASE_URL}/orders?limit=5`, {
            credentials: 'include'
        });
        
        if (!response.ok) throw new Error('Failed to fetch activity');
        
        const data = await response.json();
        const activityLog = document.getElementById('activityLog');
        
        if (!data.orders || data.orders.length === 0) {
            activityLog.innerHTML = `
                <div style="text-align: center; padding: 3rem; opacity: 0.7;">
                    <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <p>No recent activity</p>
                </div>
            `;
            return;
        }

        activityLog.innerHTML = '';
        data.orders.forEach(order => {
            const statusColor = order.payment_status === 'completed' ? '#4ecdc4' : 
                               order.payment_status === 'failed' ? '#ff6b6b' : '#ffeaa7';
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <div class="activity-icon-wrapper" style="background: linear-gradient(45deg, ${statusColor}, ${statusColor}90);">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">Order #${order.id}</div>
                    <div class="activity-time">${formatTimeAgo(new Date(order.created_at))} • $${order.total_amount}</div>
                </div>
            `;
            activityLog.appendChild(item);
        });
    } catch (error) {
        console.error('Error loading admin activity:', error);
        document.getElementById('activityLog').innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                <i class="fas fa-exclamation-triangle"></i>
                Failed to load activity
            </div>
        `;
    }
}

// Load notifications
async function loadNotifications() {
    try {
        const response = await fetch(`${API_BASE_URL}/notifications/counts`, {
            credentials: 'include'
        });
        
        if (!response.ok) throw new Error('Failed to fetch notifications');
        
        const data = await response.json();
        const badge = document.getElementById('notificationBadge');
        
        if (data.total > 0) {
            badge.textContent = data.total;
            badge.style.display = 'inline-block';
        } else {
            badge.style.display = 'none';
        }
    } catch (error) {
        console.error('Error loading notifications:', error);
    }
}

// Initialize particles
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = 50;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 10 + 's';
        particle.style.animationDuration = (Math.random() * 10 + 5) + 's';
        particlesContainer.appendChild(particle);
    }
}

// Initialize scroll animations
function initScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    });

    document.querySelectorAll('.fade-in-up').forEach(el => {
        observer.observe(el);
    });
}

// Tab switching functionality
function switchTab(tabName) {
    // Remove active class from all tabs and contents
    document.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    // Add active class to selected tab and content
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Load sessions if switching to sessions tab
    if (tabName === 'sessions') {
        loadSessions();
    }
}

// Load sessions
async function loadSessions() {
    try {
        const sessionsList = document.getElementById('sessionsList');
        sessionsList.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                Loading sessions...
            </div>
        `;
        
        // For now, we'll just show the current session
        // In a real implementation, you would fetch active sessions from your backend
        setTimeout(() => {
            sessionsList.innerHTML = `
                <div class="activity-item">
                    <div class="activity-icon-wrapper">
                        <i class="fas fa-desktop"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Current Session <span style="color: #4ecdc4; font-weight: bold;">(Active)</span></div>
                        <div class="activity-time">Active now • ${navigator.userAgent}</div>
                    </div>
                    <button class="btn btn-danger" style="padding: 0.5rem 1rem;" onclick="terminateSession(this)">
                        <i class="fas fa-times"></i>
                        Terminate
                    </button>
                </div>
            `;
        }, 1000);
    } catch (error) {
        console.error('Error loading sessions:', error);
        document.getElementById('sessionsList').innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                <i class="fas fa-exclamation-triangle"></i>
                Failed to load sessions
            </div>
        `;
    }
}

// Show notification
function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 1rem;">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.getElementById('notificationContainer').appendChild(notification);
    
    // Show notification
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Hide and remove notification
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 400);
    }, 4000);
}

// Avatar upload functionality
function uploadAvatar() {
    document.getElementById('fileInput').click();
}

document.getElementById('fileInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarInner = document.getElementById('avatarInner');
            avatarInner.innerHTML = `
                <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                <div class="avatar-upload-overlay">
                    <i class="fas fa-camera" style="font-size: 2rem;"></i>
                </div>
            `;
            showNotification('Profile picture updated successfully!', 'success');
        };
        reader.readAsDataURL(file);
    }
});

// Form submissions - FIXED PROFILE UPDATE
document.getElementById('personalInfoForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const fullName = document.getElementById('fullName').value;
    const phone = document.getElementById('phone').value;
    
    if (!fullName.trim()) {
        showNotification('Please enter your full name', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/admin-users/${userProfile.id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                full_name: fullName,
                phone: phone
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to update profile');
        }
        
        const data = await response.json();
        
        // Update local profile and UI
        userProfile.full_name = fullName;
        userProfile.phone = phone;
        document.getElementById('heroTitle').textContent = fullName;
        document.getElementById('avatarInitials').textContent = getInitials(fullName);

        showNotification('Personal information updated successfully!', 'success');
    } catch (error) {
        console.error('Error updating profile:', error);
        showNotification('Failed to update profile: ' + error.message, 'error');
    }
});

// FIXED PASSWORD UPDATE FUNCTIONALITY
document.getElementById('passwordForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const currentPassword = document.getElementById('currentPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // Validation
    if (!currentPassword) {
        showNotification('Please enter your current password', 'warning');
        return;
    }
    
    if (!newPassword) {
        showNotification('Please enter a new password', 'warning');
        return;
    }
    
    if (newPassword !== confirmPassword) {
        showNotification('New passwords do not match!', 'error');
        return;
    }
    
    if (newPassword.length < 8) {
        showNotification('Password must be at least 8 characters long!', 'warning');
        return;
    }
    
    try {
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        submitBtn.disabled = true;
        
        // Call the password update endpoint
        const response = await fetch(`${API_BASE_URL}/update-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                current_password: currentPassword,
                new_password: newPassword
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to update password');
        }
        
        const data = await response.json();
        
        showNotification('Password updated successfully!', 'success');
        
        // Reset form
        this.reset();
        
        // Restore button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
    } catch (error) {
        console.error('Error updating password:', error);
        
        // Restore button state
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-lock"></i> Update Password';
        submitBtn.disabled = false;
        
        // Handle specific error cases
        if (error.message.includes('current password') || error.message.includes('incorrect')) {
            showNotification('Current password is incorrect', 'error');
        } else if (error.message.includes('same')) {
            showNotification('New password must be different from current password', 'error');
        } else {
            showNotification('Failed to update password: ' + error.message, 'error');
        }
    }
});

// Permission toggles (admin only)
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('permission-toggle') && isAdmin) {
        const card = e.target.closest('.permission-card');
        const toggle = e.target;
        
        card.classList.toggle('active');
        toggle.classList.toggle('active');
    }
});

// Update permissions (admin only)
async function updatePermissions() {
    if (!isAdmin) return;
    
    const activePermissions = [];
    document.querySelectorAll('.permission-toggle.active').forEach(toggle => {
        activePermissions.push(toggle.dataset.permission);
    });
    
    try {
        const response = await fetch(`${API_BASE_URL}/admin-users/${userProfile.id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({
                permissions: activePermissions
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to update permissions');
        }
        
        userProfile.permissions = activePermissions;
        document.getElementById('permissionsCount').textContent = activePermissions.length;
        showNotification('Permissions updated successfully!', 'success');
    } catch (error) {
        console.error('Error updating permissions:', error);
        showNotification('Failed to update permissions: ' + error.message, 'error');
    }
}

// Terminate session
function terminateSession(button) {
    if (confirm('Are you sure you want to terminate this session?')) {
        button.closest('.activity-item').style.opacity = '0.5';
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Terminating...';
        
        setTimeout(() => {
            showNotification('Session terminated successfully', 'success');
            button.closest('.activity-item').remove();
        }, 1000);
    }
}

// View full activity log
function viewFullActivity() {
    window.location.href = 'pages/orders.html';
}

// Logout function
async function logout() {
    try {
        const response = await fetch(`${API_BASE_URL}/logout`, {
            method: 'POST',
            credentials: 'include'
        });
        
        if (!response.ok) {
            throw new Error('Logout failed');
        }
        
        showNotification('Logging out...', 'success');
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 1500);
    } catch (error) {
        console.error('Logout error:', error);
        showNotification('Error logging out', 'error');
    }
}

// Utility functions
function getInitials(name) {
    if (!name) return 'U';
    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
}

function capitalizeRole(role) {
    if (!role) return 'User';
    return role.split('_').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ');
}

function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

function formatTimeAgo(date) {
    const now = new Date();
    const diff = now - date;
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);

    if (minutes < 1) return 'Just now';
    if (minutes < 60) return `${minutes}m ago`;
    if (hours < 24) return `${hours}h ago`;
    return `${days}d ago`;
}

function formatDate(date) {
    return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', async function() {
    console.log('Profile page loading...');
    
    createParticles();
    initScrollAnimations();
    
    // Check authentication and load profile
    await checkAuth();
    
    // Add welcome message after profile loads
    setTimeout(() => {
        const name = userProfile?.full_name || 'User';
        showNotification(`Welcome back, ${name}! Your profile is ready.`, 'success');
    }, 1000);
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + S to save
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        const activeTab = document.querySelector('.tab-content.active');
        if (activeTab && activeTab.id === 'password-tab') {
            document.getElementById('passwordForm').dispatchEvent(new Event('submit'));
        } else {
            document.getElementById('personalInfoForm').dispatchEvent(new Event('submit'));
        }
    }
});

// Add interactive effects
document.querySelectorAll('.glass-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-8px) scale(1.02)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(-8px) scale(1)';
    });
});

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Add this function to handle admin users update (needed for your backend)
async function updateAdminUser(adminId, updateData) {
    try {
        const response = await fetch(`${API_BASE_URL}/admin-users/${adminId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify(updateData)
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to update admin user');
        }
        
        return await response.json();
    } catch (error) {
        console.error('Error updating admin user:', error);
        throw error;
    }
}
    </script>
</body>
</html>
